[{"title":"My first Post","url":"/2022/05/28/My-first-Post/","content":"<p>And here we start a new journey.</p>\n<p>pic bed test: </p>\n<p><img src=\"https://md-pic-bed.oss-cn-hongkong.aliyuncs.com/img/image-20220522223044162.png\" alt=\"image-20220522223044162\"></p>\n","tags":["Hexo"]},{"title":"代理技术","url":"/2022/05/28/%E4%BB%A3%E7%90%86%E6%8A%80%E6%9C%AF/","content":"<h1 id=\"代理技术\"><a href=\"#代理技术\" class=\"headerlink\" title=\"代理技术\"></a>代理技术</h1><h2 id=\"代理协议工作在哪一层\"><a href=\"#代理协议工作在哪一层\" class=\"headerlink\" title=\"代理协议工作在哪一层\"></a>代理协议工作在哪一层</h2><p>Socks代理协议是一种工作在<em><strong>线路层</strong></em>的协议，HTTP代理协议是一种工作在<em><strong>应用层</strong></em>的协议。</p>\n<h2 id=\"基于虚拟设备TUN-x2F-TAP技术的“真”全局代理\"><a href=\"#基于虚拟设备TUN-x2F-TAP技术的“真”全局代理\" class=\"headerlink\" title=\"基于虚拟设备TUN&#x2F;TAP技术的“真”全局代理\"></a>基于虚拟设备TUN&#x2F;TAP技术的“真”全局代理</h2><p> SOCKS5工作在线路层，<strong>SOCKS</strong>协议位于传输层(<strong>TCP</strong>&#x2F;<strong>UDP</strong>等)与应用层之间，所以能代理TCP和UDP的网络流量，<strong>对于之下的网络流量，就无能为力了</strong>。</p>\n<p>TUN2SOCKS使用tun网卡实现了更加底层的流量代理，这种全局代理不仅可以代理传输层流量，还可以代理其它所有应用程序的请求流量，比如代理游戏的流量，代理所有命令行工具的流量。</p>\n<p>一般的代理软件的“全局代理”指的是不论访问的IP是哪的全部都走代理，但是这种代理软件使用的代理协议的工作层次是<strong>不够底层</strong>的，在cmd会发现<strong>无法ping通google</strong>（但是<strong>使用curl却能够获得google的html内容</strong>，这是因为ping走的是ICMP而curl走的是HTTP）。</p>\n<p><img src=\"https://md-pic-bed.oss-cn-hongkong.aliyuncs.com/img/image-20220525102729845.png\" alt=\"image-20220525102729845\"></p>\n<p>而像Netch等比较专业的代理软件则使用了tun2socks等虚拟网卡技术，在使用这种软件的全局代理时是可以在cmd中使用ping通google的。</p>\n<p><img src=\"https://md-pic-bed.oss-cn-hongkong.aliyuncs.com/img/image-20220525103044641.png\" alt=\"image-20220525103044641\"></p>\n<p>因此，像要使用pip、apt-get等需要在shell中访问外网的场景时，强烈推荐Netch等使用基于虚拟网卡的能够代理低层数据包的软件。</p>\n<h2 id=\"如何使得虚拟机的流量也走代理\"><a href=\"#如何使得虚拟机的流量也走代理\" class=\"headerlink\" title=\"如何使得虚拟机的流量也走代理\"></a>如何使得虚拟机的流量也走代理</h2><p><strong>场景：</strong></p>\n<ol>\n<li>VMware Ubuntu虚拟机要使用apt等安装软件<em><strong>（显然我们不想搞什么换源）</strong></em></li>\n<li>开发板（例如PYNQ）上跑的Ubuntu要使用apt等安装软件<em><strong>（显然我们不想搞什么换源）</strong></em>，且开发板是通过网线与PC连接的。</li>\n</ol>\n<p><strong>方法1：</strong></p>\n<p>首先在宿主机上打开代理，并且确定<em><strong>允许其他设备连入Socks5本地端口</strong></em></p>\n<p>之后在虚拟机终端中输入以下命令：</p>\n<p><code>export  ALL_PROXY=socks5://192.168.86.1:2801</code></p>\n<p>注意更改IP和端口。</p>\n<p><strong>方法2：</strong></p>\n<p>首先需要在宿主上运行起clash，并将clash进行如下设置。</p>\n<p><img src=\"https://md-pic-bed.oss-cn-hongkong.aliyuncs.com/img/image-20220724115525450.png\" alt=\"image-20220724115525450\"></p>\n<p>VMware中将虚拟的网络适配器设置为NAT，取消虚拟机Ubuntu的手动DNS，设置为自动。</p>\n<p><img src=\"https://md-pic-bed.oss-cn-hongkong.aliyuncs.com/img/image-20220724120024200.png\" alt=\"image-20220724120024200\"></p>\n<p><img src=\"https://md-pic-bed.oss-cn-hongkong.aliyuncs.com/img/image-20220724115856787.png\" alt=\"image-20220724115856787\"></p>\n<p>设置完毕，效果如下。</p>\n<p><img src=\"https://md-pic-bed.oss-cn-hongkong.aliyuncs.com/img/image-20220724120101155.png\" alt=\"image-20220724120101155\"></p>\n<p><img src=\"https://md-pic-bed.oss-cn-hongkong.aliyuncs.com/img/image-20220724120401278.png\" alt=\"image-20220724120401278\"></p>\n<p>需要注意的是，这种方法设置下虽然宿主机和虚拟机均能ping通google，但是所显示的google的IP都是错误的（是一个保留IP地址），这应该与Clash TUN网卡的工作机制有关系。</p>\n<p><img src=\"https://md-pic-bed.oss-cn-hongkong.aliyuncs.com/img/image-20220724120219846.png\" alt=\"image-20220724120219846\"></p>\n<p><strong>方法3：</strong></p>\n<p>在虚拟机里直接跑clash</p>\n<h2 id=\"待研究的内容\"><a href=\"#待研究的内容\" class=\"headerlink\" title=\"待研究的内容\"></a>待研究的内容</h2><p>KCP</p>\n<p>DNS Hijack（AioDNS）</p>\n<h2 id=\"合适的软件\"><a href=\"#合适的软件\" class=\"headerlink\" title=\"合适的软件\"></a>合适的软件</h2><p>Clash真香😄</p>\n","tags":["VPN"]},{"title":"Python装饰器实现对（递归）函数运行时间计时","url":"/2022/06/04/python-decorator/","content":"<h1 id=\"Python-装饰器\"><a href=\"#Python-装饰器\" class=\"headerlink\" title=\"Python 装饰器\"></a>Python 装饰器</h1><p>场景需求：需要对函数运行时间进行计时，希望能够自动化完成计时代码的插桩工作。</p>\n<p>难点：递归函数，举例来说，假设我调用fibonacci(4)，我不希望计时只计最外层的函数，而是希望每一个被调用的fibonacci()都输出，fib的调用层次如下图所示</p>\n<p><img src=\"https://md-pic-bed.oss-cn-hongkong.aliyuncs.com/img/image-20220604190247526.png\" alt=\"image-20220604190247526\"></p>\n<p>也就是计时器应该输出5次函数运行耗时</p>\n<p>解决方案：<a href=\"https://zhuanlan.zhihu.com/p/197643740\">https://zhuanlan.zhihu.com/p/197643740</a> ，运行结果：</p>\n<p><img src=\"https://md-pic-bed.oss-cn-hongkong.aliyuncs.com/img/image-20220604190426304.png\" alt=\"image-20220604190426304\"></p>\n<p>感想（？）：Python好强大</p>\n<h1 id=\"Google-Colab\"><a href=\"#Google-Colab\" class=\"headerlink\" title=\"Google Colab\"></a>Google Colab</h1><p>测试代码：</p>\n<p><a href=\"https://colab.research.google.com/drive/1GML_i9JVwJKSGYCPL8_Mi2CXixXix6DF?usp=sharing\">https://colab.research.google.com/drive/1GML_i9JVwJKSGYCPL8_Mi2CXixXix6DF?usp=sharing</a></p>\n","tags":["Python"]}]